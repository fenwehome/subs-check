<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Subs Check · 管理面板</title>

  <link rel="icon" type="image/png" href="/static/icon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/static/icon/favicon.svg" />
  <link rel="shortcut icon" href="/static/icon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Subs-Check" />
  <link rel="manifest" href="/static/icon/site.webmanifest" />
  <link rel="stylesheet" href="/static/css/admin.css?v20251023">
</head>

<body>
  <!-- 登录框 -->
  <div id="loginModal" class="login-modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="login-card" role="document">
      <div class="login-logo" aria-hidden="true">
        <img src="/static/icon/favicon.svg" alt="logo" style="width:100px;height:100px" />
      </div>

      <h3 id="loginTitle" class="login-title">
        Subs-Check 配置管理
        <a href="https://github.com/sinspired/subs-check" class="version-badge btn">
          <span id="version-login">-</span>
        </a>
      </h3>

      <div class="input-wrapper">
        <input id="apiKeyInput" class="login-input" type="password" placeholder="请输入 API 密钥" />
        <button type="button" id="show-apikey" class="show-apikey">显示</button>
      </div>

      <div class="remember-wrapper">
        <label class="remember-row" style="display:flex;align-items:center;gap:4px">
          <input id="rememberKey" type="checkbox" /> 记住密钥
        </label>
        <div class="remember-hint">是否保存密钥到本地</div>
      </div>

      <div class="login-actions">
        <button id="login-button" class="btn">进入管理界面</button>
      </div>
    </div>
  </div>

  <!-- 页面头部 -->
  <header>
    <div class="hdr-left">
      <a href="https://github.com/sinspired/subs-check" target="_blank" rel="noopener noreferrer" title="访问 GitHub 项目"
        aria-label="跳转到 Subs Check GitHub 仓库">
        <div class="logo">
          <img src="/static/icon/favicon.svg" alt="logo" style="width:100%;height:100%;object-fit:cover" />
        </div>
      </a>
      <div class="site-title">
        <div style="display:flex;flex-direction:column">
          <div class="title-row">
            <h3 class="project-name"><strong>Subs Check</strong></h3>
            <!-- TODO: 有更新时在右上角显示小圆点角标 -->
            <span id="versionInline" class="version btn">-</span>
          </div>
          <small class="slogan">订阅检测 · 配置管理</small>
        </div>
      </div>
    </div>

    <div class="hdr-right">
      <!-- 小屏退出按钮 -->
      <button id="logoutBtnMobile" class="btn logout-mobile" style="display:none;" title="退出登录">
        退出
      </button>

      <div class="theme-toggle" role="group" aria-label="主题切换" style="display:flex;align-items:center;">
        <button id="themeToggle" class="icon-btn" aria-pressed="false" aria-label="切换主题" title="切换主题">
          <span class="icon" id="iconMoon">☀️</span>
          <span class="icon" id="iconSun" style="display:none;margin-bottom: 3px;">🌙</span>
        </button>
        <span class="theme-label muted">切换主题</span>
      </div>
    </div>
  </header>

  <!-- 页面主体 -->
  <main>
    <div class="layout">
      <!-- 侧滑菜单 -->
      <div id="shareMenu" class="slide-menu">
        <!-- <div class="menu-header content">订阅分享</div> -->
        <div class="menu-content">
          <p class="list-item" id="commonSub-item" role="button" tabindex="0" aria-label="复制通用订阅链接" data-link="#">通用订阅
          </p>
          <p class="list-item" id="mihomoSub-item" role="button" tabindex="1" aria-label="复制 Mihomo 订阅链接" data-link="#">
            Mihomo 订阅</p>
          <p class="list-item" id="singboxOldSub-item" role="button" tabindex="2" aria-label="复制 singbox 订阅链接"
            data-link="#">
            singbox-old 订阅</p>
          <p class="list-item" id="singboxLatestSub-item" role="button" tabindex="3" aria-label="复制 singbox 订阅链接"
            data-link="#">
            singbox-Latest 订阅</p>
        </div>
      </div>
      <div id="projectMenu" class="slide-menu">
        <!-- <div class="menu-header content">项目信息</div> -->
        <div class="menu-content">
          <div class="projectInfo">
            <div class="project-icons">
              <a id="githubMenuBtn" href="#" title="GitHub 仓库" aria-label="GitHub 项目">
                <img src="/static/icon/github.svg" alt="GitHub" class="project-icon" />
              </a>
              <a id="dockerMenuBtn" href="#" title="Docker 镜像" aria-label="Docker 镜像">
                <img src="/static/icon/docker.svg" alt="Docker" class="project-icon" />
              </a>
              <!-- <a id="telegramMenuBtn" href="#" title="Telegram 群" aria-label="Telegram 群">
                <img src="/static/icon/telegram.svg" alt="Telegram" class="project-icon" />
              </a> -->
            </div>
            <div class="project-copy">
              © 2025 <a href="https://github.com/sinspired" target="_blank" rel="noopener">sinspired</a> ·
              <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener">GPL-3.0 License</a>
            </div>
          </div>
        </div>
      </div>
      <!-- 左侧边栏 -->
      <section class="content">
        <aside class="card sidebar glass" id="sidebar">
          <div class="sidebar-top">
            <div class="title-wrap">
              <div class="title">订阅管理</div>
            </div>
            <div class="sidebar-list">
              <div class="list-item" id="share" title="V2Ray、Mihomo 、Singbox订阅地址" style="cursor:pointer;">分享订阅</div>
              <div class="list-item" id="downloadLogsBtnSide" title="下载运行日志" style="cursor:pointer;">下载日志</div>
              <div class="list-item" id="project-info" title="查看项目地址，加群交流" style="cursor:pointer;">项目信息</div>
            </div>
          </div>
          <!-- TODO: 添加底部区域 -->
          <div class="sidebar-bottom">
            <div class="list-item" id="logoutBtn" title="清除保存的 API 密钥并退出" style="cursor:pointer;">退出登录</div>
          </div>
        </aside>
      </section>


      <!-- 日志和检测进度 -->
      <section class="content" id="mainContent">
        <!-- 检测进度卡片 -->
        <div class="progressCard card">
          <div class="progress-row">
            <div class="progress-actions">
              <button id="btnToggleCheck" class="toggle-btn" aria-label="检测开关" title="开始检测">
                <!-- 内联SVG：初始idle状态 -->
                <span class="btn-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5v14l11-7z" />
                  </svg>
                </span>
              </button>
            </div>

            <!-- 进度信息 -->
            <div class="progress-info">
              <div class="progress-wrapper">
                <div style="display:flex;align-items:center;gap:4px">
                  <strong id="progressPercentTitle">进度</strong>
                  <span id="progressPercent">0%</span>
                </div>
                <div style="display:flex;align-items:center;gap:4px">
                  <div id="successTitle">可用：</div>
                  <span id="successText" style="color:var(--success);font-weight:700">0</span>
                </div>
              </div>

              <div class="progress-bar-wrap">
                <progress id="progress" max="100" value="0"></progress>
                <span id="progressText">0/0</span>
              </div>


              <!-- 历史记录占位（当进度被隐藏时显示） -->
              <div id="historyPlaceholder" class="history-placeholder" style="display:none;">
                <div class="history-title-row"
                  style="display:flex;align-items:center;justify-content:space-between;gap:8px">
                  <div class="history-title" style="font-weight:600;font-size:13px;color:var(--muted)">上次检测</div>
                  <div style="margin-left:14px">
                    <button id="btnShare" class="btn small" title="分享订阅">分享</button>
                    <button id="btnHistoryExit" class="btn small" title="退出并清除本地 API 密钥">退出</button>
                  </div>
                </div>

                <div class="history-summary"
                  style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:6px">
                  <div id="history-line" class="history-line muted"
                    style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                    <span id="historyLastTime"></span>
                    用时 <span id="historyLastDuration"></span> |
                    总数 <span id="historyLastTotal"></span> |
                    可用 <span id="historyLastAvailable" style="color:var(--success);font-weight:700">-</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 日志卡片 -->
        <div class="logsCard card" id="logArea">
          <div class="logs-header">
            <div style="display:flex;flex-direction:column">
              <div class="title-wrap">
                <div class="title">最近日志</div>
                <div id="status" class="muted status-label status-idle">状态：未登录</div>
              </div>
              <div class="muted">点击日志窗暂停滚动和刷新</div>
            </div>
            <div>
              <button id="refreshLogs" class="btn" disabled>刷新</button>
            </div>
          </div>

          <div id="logContainer" class="logs-window" role="log" aria-live="polite">
            尚未登录，请输入 API 密钥并验证以查看运行日志。
          </div>
        </div>
      </section>

      <!-- 右侧配置编辑器 -->
      <aside class="card editor" id="editorContainer">
        <div class="editor-controls">
          <div class="title-wrap">
            <div class="title">配置编辑器</div>
            <div style="display:flex;flex-direction: row;gap:8px">
              <button id="reloadCfg" class="btn" disabled>重载</button>
              <button id="saveCfg" class="btn" disabled>保存</button>
            </div>
          </div>
          <!-- <div class="muted">在此编辑并保存配置</div> -->
          <div style="align-self: flex-start; margin-top: -20px;">
            <span class="config-path muted" title="{{.configPath}}">{{.configPath}}</span>
          </div>

        </div>

        <!-- 编辑器区域 -->
        <div class="editor-wrapper">
          <div id="configEditor" aria-label="配置编辑" spellcheck="false" aria-placeholder="# 配置将于登录后加载..."></div>
          <!-- CodeMirror 容器 -->
        </div>
      </aside>
    </div>
  </main>
  <div class="footer">
    <div class="footer-icons">
      <a id="githubUrlBtn" href="#" title="GitHub 项目" aria-label="GitHub 项目">
        <img src="/static/icon/github.svg" alt="GitHub" class="footer-icon" />
      </a>
      <a id="dockerUrlBtn" href="#" title="Docker 镜像" aria-label="Docker 镜像">
        <img src="/static/icon/docker.svg" alt="Docker" class="footer-icon" />
      </a>
      <!-- <a id="telegramUrlBtn" href="#" title="Telegram 群" aria-label="Telegram 群">
          <img src="/static/icon/telegram.svg" alt="Telegram" class="footer-icon" />
        </a> -->
    </div>
    <div class="footer-copy">
      © 2025 <a href="https://github.com/sinspired" target="_blank" rel="noopener">sinspired</a> ·
      <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener">GPL-3.0 License</a>
    </div>
  </div>
  <!-- 脚本引入 -->
  <script src="/static/js/libs/js-yaml.min.js"></script>
  <script src="/static/js/libs/codemirror.bundle.js"></script>
  <script type="module" src="/static/js/admin.js?v20251023"></script>
</body>

</html>